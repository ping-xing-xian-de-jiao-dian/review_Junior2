平时：考勤、测验、实验报告

五五开，闭卷英文



---



## 一、计算机体系结构的基本原理

### 1.1计算机系统的层次

M5应用语言机、M4高级语言机、M3汇编语言机、M2操作系统机、M1传统机、M0微程序机

从M2~M5的层次是虚拟机；每个层次要依赖下一个低层去执行更原始的功能

### 1.2定义计算机体系结构

程序员可见，或者对程序执行有直接影响的属性

包括指令集设计、对组织（微结构）和硬件的设计以满足设计目标和功能需求

### 1.3测量和报告性能

响应时间、执行时间（CPU时间 = 用户CPU时间 + 系统CPU时间）；吞吐量

- 选择程序来评估性能（精确度从高到低）

  1. 真实应用
  2. 核心程序：程序的关键片段，无实际用途只用于评估性能，最便于辨析出机器单个特性的性能
  3. 玩具测试基准：10-100行的代码，运行结果已知，易于键入可运行于几乎所有计算机
  4. 合成测试基准：匹配程序中操作和操作数的平均频率

- 报告性能结果

  1. **可重现性**
  2. 要求完整的描述：机器总体描述、编译可选项
  3. 包含实际性能时间，并用表或图的形式表示

- 归一化执行时间，几何平均值判断优劣（乘完开n次根号）

  但是不预测时间，只能评价好坏

### 1.4计算机设计的量化原理

**使常见情况更快**

- 阿姆达尔定律

  由某些部分加速所得到的性能提高，受加速部分的百分率所限

- 加速比

  提高之前时间 / 提高之后的时间，也就是提高之后的效率 / 提高之前的效率

  取决于两个因素

  1. 能加速的部分Fraction~enhanced~≤1
  2. 能加速的程度Speedup~enhanced~＞1

- 新的执行时间

  <img src="体系结构.assets/image-20220304155355941.png" alt="image-20220304155355941" style="zoom:67%;" />

- 回报递减法则

  对于一部分性能的提高，总体加速比的提高呈递减，总体加速比有上界（Speedup~enhanced~增大到无穷后整体有极限值）

> #### 例：实现浮点平方根
>
> 所有任务的20%是求浮点平方根
>
> 1. 加入FPSQR硬件，提升浮点平方根速度10倍
> 2. 提升所有任务的50%速度2倍（包含浮点平方根）
>
> 用阿姆达尔定律计算，2性价比高

- CPU性能方程

  CPU是非常复杂的时序结构

  <img src="体系结构.assets/image-20220308101900974.png" alt="image-20220308101900974" style="zoom:80%;" />

- 每条指令的平均时钟数（CPI）/ 每条指令运行多少周期

  IC：指令数

  <img src="体系结构.assets/image-20220308102438719.png" alt="image-20220308102438719" style="zoom:80%;" />

- 推导公式

  <img src="体系结构.assets/image-20220308102528092.png" alt="image-20220308102528092" style="zoom:80%;" />

- 很难改变一个参数而不影响其它参数

  clock cycle 由组织硬件决定

  CPI由ISA（指令集架构）和组织决定

  IC由编译系统和ISA决定

- 其它公式

  <img src="体系结构.assets/image-20220308103309428.png" alt="image-20220308103309428" style="zoom:80%;" />

- 引用局部性

  程序倾向于重用刚用过的数据和指令（90%的时间运行于10%的程序上）



### 1.5计算机体系结构的分类

SISD（单指令流单数据流）、SIMD（单指令流多数据流）、MIMD（多指令流多数据流）、MISD（多指令流单数据流）

![image-20220308114542891](体系结构.assets/image-20220308114542891.png)

## *二、指令集架构

### 2.1 指令集体系结构分类

指令 = 操作码 + 操作数

C = A + B的操作

<img src="D:\C_full\体系结构\体系结构.assets\image-20220315101821732.png" alt="image-20220315101821732" style="zoom:80%;" />

寄存器-存储器体系结构、寄存器-寄存器体系结构



### 2.2 解释存储地址

汇编内容



### 2.3 寻址模式

体系结构至少应该支持位移寻址、立即数寻址、寄存器间接寻址



### 2.4 优化指令格式

操作码：霍夫曼树、1235编码、24编码

操作数：可用间接寻址、 位移寻址来缩短操作数长度



### 2.5 指令集中的操作

load：内存取到CPU

store：寄存器往内存里存

控制流：jump无条件，branch有条件



### 2.6 精简指令集计算机与复杂指令集计算机

RISC和CISC

- RISC

  指令类型少、运行快，指令简单，更少晶体管，设计和制造更便宜

- CISC

  指令多，寻址能力强，寄存器少



### 2.7 DLX体系结构



## 三、流水线

## 四、存储层次

